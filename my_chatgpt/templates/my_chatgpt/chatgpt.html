{% extends 'my_chatgpt/chatgpt_base.html' %} {% load static %} 
{% block title%}My ChatGPT{% endblock %} {% block header %}
<h4>My ChatGPT</h4>
{% endblock %} {% load crispy_forms_tags %} {%block content %}

<div class="container mt-5">
  <form id="chat-form">
    {% csrf_token %}
    <div class="mb-3">
      <label for="prompt" class="form-label">Enter your prompt:</label>
      <textarea
        class="form-control"
        id="prompt"
        name="prompt"
        rows="3"
      ></textarea>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
  <div id="response" class="mt-3"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

{% block script_block %}
<script
  src="https://code.jquery.com/jquery-3.7.0.js"
  integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM="
  crossorigin="anonymous"
></script>
{% endblock %}

<script>
  $(document).ready(function () {
    console.log("Page loaded");
    $("#chat-form").submit(function (event) {
      event.preventDefault();
      console.log("Form submitted");
      $.ajax({
        type: "POST",
        url: '{% url "my_chatgpt:chatgpt_response" %}', // Adjust this URL if necessary based on your app's routing.
        data: {
          prompt: $("#prompt").val(),
          csrfmiddlewaretoken: $("input[name=csrfmiddlewaretoken]").val(),
        },
        success: function (data) {
          $("#response").text(data.response);
        },
        error: function (xhr, status, error) {
          console.error("Error:", error);
        },
      });
    });
  });
</script>

{% endblock %}
